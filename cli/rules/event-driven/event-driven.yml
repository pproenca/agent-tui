id: event-driven
language: rust
severity: warning
message: "Avoid std::thread::sleep in async contexts; use tokio::time::sleep or spawn_blocking."
note: |
  Blocking sleeps halt the async runtime thread and can starve other tasks.
  Use tokio::time::sleep for async delays, or spawn_blocking for blocking work.
rule:
  any:
    - pattern: std::thread::sleep($$$)
    - pattern: thread::sleep($$$)
  inside:
    any:
      - kind: function_item
        has:
          kind: function_modifiers
          regex: "async"
          stopBy: end
        stopBy: end
      - pattern: async { $$$ }
      - pattern: async move { $$$ }
      - pattern: async |$$$| { $$$ }
      - pattern: async move |$$$| { $$$ }
  not:
    any:
      - inside:
          pattern: tokio::task::spawn_blocking($$$)
          stopBy: end
      - inside:
          pattern: tokio::spawn_blocking($$$)
          stopBy: end
