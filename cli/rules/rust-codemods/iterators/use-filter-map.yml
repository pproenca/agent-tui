id: iter-use-filter-map
language: rust
severity: warning
message: "Consider using filter_map() instead of filter().map() with unwrap()"
note: |
  filter_map() combines filtering and mapping, eliminating the need for unwrap().

  Before: iter.filter(|x| x.is_ok()).map(|x| x.unwrap())
  After:  iter.filter_map(|x| x.ok())

  This is safer and more idiomatic.
rule:
  any:
    - pattern: $ITER.filter(|$X| $X.is_ok()).map(|$Y| $Y.unwrap())
    - pattern: $ITER.filter(|$X| $X.is_some()).map(|$Y| $Y.unwrap())
