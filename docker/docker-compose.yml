# docker-compose.yml - Cross-compilation orchestration for agent-tui
#
# Usage:
#   npm run build:linux-x64      # Build Linux x64 binary
#   npm run build:linux-arm64    # Build Linux arm64 binary
#   npm run build:all-platforms  # Build all Linux binaries
#
# Binaries are output to ../bin/ with platform-specific naming.

services:
  linux-x64:
    build:
      context: ..
      dockerfile: docker/Dockerfile.build
      args:
        TARGET: x86_64-unknown-linux-gnu
      target: builder
    volumes:
      - ../bin:/output
    command: >
      sh -c "cp /build/cli/target/x86_64-unknown-linux-gnu/release/agent-tui /output/agent-tui-linux-x64 &&
             chmod 755 /output/agent-tui-linux-x64 &&
             echo 'Built: agent-tui-linux-x64'"

  linux-arm64:
    build:
      context: ..
      dockerfile: docker/Dockerfile.build
      args:
        TARGET: aarch64-unknown-linux-gnu
      target: builder
    volumes:
      - ../bin:/output
    command: >
      sh -c "cp /build/cli/target/aarch64-unknown-linux-gnu/release/agent-tui /output/agent-tui-linux-arm64 &&
             chmod 755 /output/agent-tui-linux-arm64 &&
             echo 'Built: agent-tui-linux-arm64'"
