---
title: Optimal Workflow
description: 'The recommended interaction pattern for AI agents'
---

## The Standard Pattern

Every agent-tui interaction should follow this pattern:

```
Spawn → Wait → Snapshot → Interact → Wait → Repeat → Kill
```

```bash
# 1. Spawn
agent-tui spawn "your-command"

# 2. Wait for ready
agent-tui wait --stable --timeout 5000

# 3. Snapshot (see what's available)
agent-tui snapshot -i

# 4. Interact (fill, click, keystroke)
agent-tui fill @e1 "value"

# 5. Wait (for UI to update)
agent-tui wait --stable

# 6. Repeat 3-5 as needed
agent-tui snapshot -i
agent-tui keystroke Enter
agent-tui wait --stable

# 7. Kill (cleanup)
agent-tui kill
```

## Why This Pattern?

### Spawn → Wait

TUI applications need time to initialize. Jumping straight to interaction can fail:

```bash
# BAD - might fail
agent-tui spawn htop
agent-tui snapshot -i  # App might not be ready!

# GOOD - wait for stability
agent-tui spawn htop
agent-tui wait --stable --timeout 5000
agent-tui snapshot -i  # Now it's ready
```

### Snapshot → Interact

Element refs are assigned at snapshot time. Using refs without a recent snapshot is unreliable:

```bash
# BAD - refs might be stale
agent-tui fill @e1 "value"

# GOOD - always snapshot first
agent-tui snapshot -i
agent-tui fill @e1 "value"
```

### Interact → Wait

After any interaction, the UI may change. Wait before the next action:

```bash
# BAD - might miss UI update
agent-tui keystroke Enter
agent-tui snapshot -i  # UI might still be updating!

# GOOD - wait for stability
agent-tui keystroke Enter
agent-tui wait --stable
agent-tui snapshot -i  # Now we see the updated UI
```

## Wait Strategies

### `wait --stable`

Best for: Unknown completion time, dynamic UIs

```bash
agent-tui keystroke Enter
agent-tui wait --stable --timeout 10000
```

### `wait "text"`

Best for: Known completion text

```bash
agent-tui keystroke Enter
agent-tui wait "Success!" --timeout 60000
```

### `wait --element @ref`

Best for: Waiting for specific UI element

```bash
agent-tui keystroke Tab
agent-tui wait --element @e1 --timeout 5000
```

## Error Handling Pattern

Always handle potential failures:

```bash
# Robust pattern
if agent-tui spawn "npx create-next-app"; then
    if agent-tui wait "project name" --timeout 30000; then
        agent-tui snapshot -i
        agent-tui fill @e1 "my-app"
    else
        echo "Failed to reach first prompt"
        agent-tui snapshot  # Debug: see current state
    fi
    agent-tui kill  # Always cleanup
else
    echo "Failed to spawn"
fi
```

## Parallel Sessions

For complex workflows, use named sessions:

```bash
# Start multiple sessions
agent-tui spawn "npm init" --session session-a
agent-tui spawn "npm init" --session session-b

# Work with each
agent-tui --session session-a wait --stable
agent-tui --session session-a snapshot -i
agent-tui --session session-a fill @e1 "package-a"

agent-tui --session session-b wait --stable
agent-tui --session session-b snapshot -i
agent-tui --session session-b fill @e1 "package-b"

# Cleanup all
agent-tui kill --session session-a
agent-tui kill --session session-b
```

## Timeouts by Operation Type

| Operation | Recommended Timeout |
|-----------|-------------------|
| UI load | 5-10 seconds |
| Form navigation | 2-5 seconds |
| Local command | 10-30 seconds |
| npm install | 120-300 seconds |
| Full project scaffold | 180-600 seconds |
| Claude Code task | 60-600 seconds |

## Anti-Patterns

### Don't Skip Waits

```bash
# BAD
agent-tui keystroke Enter
agent-tui keystroke Enter
agent-tui keystroke Enter

# GOOD
agent-tui keystroke Enter
agent-tui wait --stable
agent-tui keystroke Enter
agent-tui wait --stable
agent-tui keystroke Enter
```

### Don't Reuse Stale Refs

```bash
# BAD
agent-tui snapshot -i  # @e1 = name input
# ... many operations later ...
agent-tui fill @e1 "value"  # @e1 might be different now!

# GOOD
agent-tui snapshot -i  # Fresh refs
agent-tui fill @e1 "value"
```

### Don't Forget Cleanup

```bash
# BAD
agent-tui spawn htop
# ... do work ...
# forgot to kill!

# GOOD
agent-tui spawn htop
# ... do work ...
agent-tui kill  # Always cleanup
```

## See Also

- [Troubleshooting](/ai-integration/troubleshooting) — When things go wrong
- [Commands Overview](/commands/overview) — All available commands
